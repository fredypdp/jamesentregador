import os
import random
import telebot
from telebot import types
from babel.numbers import format_currency

Token = os.environ.get("CHAVE_API")
bot = telebot.TeleBot(Token)

pizzaSelecionada = {}
monarkSelecionado = {}

@bot.message_handler(commands=["reclamar"])
def reclamar(mensagem):
    respostas = [
        "P√¥, eu sei que a entrega t√° demorando, mas, meu camarada, a situa√ß√£o aqui t√° complicada! Tem tr√¢nsito, vias interditadas, e at√© o clima do Rio que n√£o ajuda. T√¥ fazendo o meu melhor pra chegar a√≠ logo!",
        
        "Cara, atrasou mesmo, n√£o vou negar. Mas olha, t√° dif√≠cil navegar nessa cidade, com tanto perrengue no caminho. Acredita em mim, t√¥ correndo pra te entregar isso o mais r√°pido poss√≠vel!",
        
        "√î meu chapa, entendo a sua bronca, mas aqui no Rio √© sinistro, n√©? Tem uns lugares que eu tenho que dar uma de ninja pra n√£o levar um preju. Relaxa, t√¥ chegando a√≠ com o seu pedido, pode crer!",
        
        "T√¥ ligado que voc√™ t√° puto com a demora, mas o Rio t√° uma loucura! Tem umas paradas rolando no meio do caminho que eu n√£o controlo. Juro que t√¥ dando meu melhor pra te entregar o que voc√™ pediu!",
        
        "Fala, irm√£o, eu sei que t√° esperando faz tempo, mas o role t√° brabo hoje. T√¥ correndo igual um maluco pra chegar a√≠. Me desculpa pela demora, vou tentar ser mais r√°pido na pr√≥xima, blz?"
    ]
    texto = random.choice(respostas)

    markup = types.InlineKeyboardMarkup()

    # Adicione bot√µes inline com comandos
    botao1 = types.InlineKeyboardButton("Inicioüè†", callback_data='inicio')

    markup.add(botao1)

    bot.send_message(mensagem.chat.id, texto, reply_markup=markup)

@bot.message_handler(commands=["sobre"])
def sobre(mensagem):
    introducoes = [
        "E a√≠, meu camarada! Sou um entregador carioca, trazendo aquele gostinho do Rio at√© a sua porta. Preparado para receber um sabor carioca no conforto da sua casa?",
        "Ei, beleza? Eu sou o entregador carioca que vai levar at√© voc√™ o calor do Rio em cada pedido. √â sempre um prazer fazer parte do seu dia!",
        "Fala a√≠, galera! Eu sou o entregador carioca que vai trazer o tempero da Cidade Maravilhosa direto para a sua mesa. Vamos fazer desse momento uma viagem gastron√¥mica!",
        "Salve, pessoal! Aqui √© o entregador carioca, trazendo todo o ritmo e sabor do Rio para a sua casa. √â hora de se deliciar com o que temos de melhor por aqui!"
    ]
    texto = random.choice(introducoes)

    markup = types.InlineKeyboardMarkup()

    # Adicione bot√µes inline com comandos
    botao1 = types.InlineKeyboardButton("Inicioüè†", callback_data='inicio')

    markup.add(botao1)

    bot.send_message(mensagem.chat.id, texto, reply_markup=markup)

@bot.message_handler(commands=["cardapio"])
def cardapio(mensagem):
    texto = """
Qual sabor desejaüçïüçï?
    /nutella Nutellaüç´
    /calabresa Calabresaüçï
    /portuguesa Portuguesaüáµüáπ
    /frango Frango com catupiryüßÄ
    /recomendacao Pedir recomenda√ß√£oüÜò"""

    markup = types.InlineKeyboardMarkup()

    # Adicione bot√µes inline com comandos
    botao1 = types.InlineKeyboardButton("Pizza de Nutellaüç´", callback_data='nutella')
    botao2 = types.InlineKeyboardButton("Pizza de Calabresaüçï", callback_data='calabresa')
    botao3 = types.InlineKeyboardButton("Pizza Portuguesaüáµüáπ", callback_data='portuguesa')
    botao4 = types.InlineKeyboardButton("Pizza de Frango e CatupiryüßÄ", callback_data='frango')
    botao5 = types.InlineKeyboardButton("Pedir recomenda√ß√£oüÜò", callback_data='recomendacao')
    botao6 = types.InlineKeyboardButton("Inicioüè†", callback_data='inicio')

    markup.add(botao1, botao2)
    markup.add(botao3, botao4)
    markup.add(botao5, botao6)

    bot.reply_to(mensagem, texto, reply_markup=markup)

@bot.message_handler(commands=["nutella"])
def nutella(mensagem):
    texto = """
    Escolha o tamanho:
    1 - Pequena, R$20,00
    2 - M√©dia, R$35,00
    3 - Grande, R$45,00
Digite o n√∫mero do tamanho que deseja, ou clique em um dos bot√µes abaixo:"""

    markup = types.InlineKeyboardMarkup()

    # Adicione bot√µes inline com comandos
    botao1 = types.InlineKeyboardButton("Pequena", callback_data='pequena')
    botao2 = types.InlineKeyboardButton("M√©dia", callback_data='media')
    botao3 = types.InlineKeyboardButton("Grande", callback_data='grande')
    botao4 = types.InlineKeyboardButton("Inicioüè†", callback_data='inicio')

    markup.add(botao1, botao2, botao3)
    markup.add(botao4)

    global pizzaSelecionada
    pizzaSelecionada["sabor"] = "nutella"
    bot.reply_to(mensagem, texto, reply_markup=markup)

@bot.message_handler(commands=["calabresa"])
def calabresa(mensagem):
    texto = """
    Escolha o tamanho:
    1 - Pequena, R$30,00
    2 - M√©dia, R$45.00
    3 - Grande, R$50.00
Digite o n√∫mero do tamanho que deseja, ou clique em um dos bot√µes abaixo:"""

    markup = types.InlineKeyboardMarkup()

    # Adicione bot√µes inline com comandos
    botao1 = types.InlineKeyboardButton("Pequena", callback_data='pequena')
    botao2 = types.InlineKeyboardButton("M√©dia", callback_data='media')
    botao3 = types.InlineKeyboardButton("Grande", callback_data='grande')
    botao4 = types.InlineKeyboardButton("Inicioüè†", callback_data='inicio')

    markup.add(botao1, botao2, botao3)
    markup.add(botao4)

    global pizzaSelecionada
    pizzaSelecionada["sabor"] = "calabresa"
    bot.reply_to(mensagem, texto, reply_markup=markup)

@bot.message_handler(commands=["portuguesa"])
def portuguesa(mensagem):
    texto = """
    Escolha o tamanho:
    1 - Pequena, R$20,00
    2 - M√©dia, R$35.00
    3 - Grande, R$45.00
Digite o n√∫mero do tamanho que deseja, ou clique em um dos bot√µes abaixo:"""

    markup = types.InlineKeyboardMarkup()

    # Adicione bot√µes inline com comandos
    botao1 = types.InlineKeyboardButton("Pequena", callback_data='pequena')
    botao2 = types.InlineKeyboardButton("M√©dia", callback_data='media')
    botao3 = types.InlineKeyboardButton("Grande", callback_data='grande')
    botao4 = types.InlineKeyboardButton("Inicioüè†", callback_data='inicio')

    markup.add(botao1, botao2, botao3)
    markup.add(botao4)

    global pizzaSelecionada
    pizzaSelecionada["sabor"] = "portuguesa"
    bot.reply_to(mensagem, texto, reply_markup=markup)

@bot.message_handler(commands=["frango"])
def frango(mensagem):
    texto = """
    Escolha o tamanho:
    1 - Pequena, R$30,00
    2 - M√©dia, R$45.00
    3 - Grande, R$60.00
Digite o n√∫mero do tamanho que deseja, ou clique em um dos bot√µes abaixo:"""

    markup = types.InlineKeyboardMarkup()

    # Adicione bot√µes inline com comandos
    botao1 = types.InlineKeyboardButton("Pequena", callback_data='pequena')
    botao2 = types.InlineKeyboardButton("M√©dia", callback_data='media')
    botao3 = types.InlineKeyboardButton("Grande", callback_data='grande')
    botao4 = types.InlineKeyboardButton("Inicioüè†", callback_data='inicio')

    markup.add(botao1, botao2, botao3)
    markup.add(botao4)

    global pizzaSelecionada
    pizzaSelecionada["sabor"] = "Frango e Catupiry"
    bot.reply_to(mensagem, texto, reply_markup=markup)

@bot.message_handler(commands=["recomendacao"])
def recomendacao(mensagem):
    recomendacoes = [
        "Nutella: Se voc√™ √© um amante de sobremesas, n√£o pode deixar de experimentar nossa deliciosa pizza de Nutella. Uma combina√ß√£o irresist√≠vel de massa crocante coberta com Nutella cremosa e uma pitada de avel√£s torradas. Uma verdadeira indulg√™ncia para os amantes de chocolate!",
        "Calabresa: A pizza de calabresa √© um cl√°ssico que nunca sai de moda. Nossa vers√£o √© feita com uma massa fina e crocante, generosamente coberta com fatias suculentas de lingui√ßa calabresa, queijo derretido e um toque especial de pimenta. Uma explos√£o de sabores que vai deixar seu paladar pedindo por mais.",
        "Portuguesa: Se voc√™ gosta de uma pizza recheada de ingredientes saborosos, a pizza portuguesa √© a escolha perfeita. Nossa massa macia √© coberta com molho de tomate, presunto, queijo, ovos, cebola, azeitonas e um toque de or√©gano. Uma combina√ß√£o harmoniosa que agrada a todos os gostos.",
        "Portuguesa: Se voc√™ gosta de uma pizza recheada de ingredientes saborosos, a pizza portuguesa √© a escolha perfeita. Nossa massa macia √© coberta com molho de tomate, presunto, queijo, ovos, cebola, azeitonas e um toque de or√©gano. Uma combina√ß√£o harmoniosa que agrada a todos os gostos."
    ]
    texto = random.choice(recomendacoes)

    markup = types.InlineKeyboardMarkup()

    # Adicione bot√µes inline com comandos
    botao1 = types.InlineKeyboardButton("Card√°pioüìã", callback_data='cardapio')
    botao2 = types.InlineKeyboardButton("Inicioüè†", callback_data='inicio')

    markup.add(botao1, botao2)

    bot.send_message(mensagem.chat.id, texto, reply_markup=markup)

def pizzaDefinirTamanho(tamanho, chatId):
    global pizzaSelecionada

    if tamanho == "1":
        pizzaSelecionada["tamanho"] = "Pequena"

        if pizzaSelecionada["sabor"] == "nutella":
            pizzaSelecionada["preco"] = 20.00
        elif pizzaSelecionada["sabor"] == "calabresa":
            pizzaSelecionada["preco"] = 30.00
        elif pizzaSelecionada["sabor"] == "portuguesa":
            pizzaSelecionada["preco"] = 20.00
        elif pizzaSelecionada["sabor"] == "frango":
            pizzaSelecionada["preco"] = 30.00
    elif tamanho == "2":
        pizzaSelecionada["tamanho"] = "M√©dia"

        if pizzaSelecionada["sabor"] == "nutella":
            pizzaSelecionada["preco"] = 35.00
        elif pizzaSelecionada["sabor"] == "calabresa":
            pizzaSelecionada["preco"] = 45.00
        elif pizzaSelecionada["sabor"] == "portuguesa":
            pizzaSelecionada["preco"] = 35.00
        elif pizzaSelecionada["sabor"] == "frango":
            pizzaSelecionada["preco"] = 45.00
    elif tamanho == "3":
        pizzaSelecionada["tamanho"] = "Grande"
        
        if pizzaSelecionada["sabor"] == "nutella":
            pizzaSelecionada["preco"] = 45.00
        elif pizzaSelecionada["sabor"] == "calabresa":
            pizzaSelecionada["preco"] = 50.00
        elif pizzaSelecionada["sabor"] == "portuguesa":
            pizzaSelecionada["preco"] = 45.00
        elif pizzaSelecionada["sabor"] == "frango":
            pizzaSelecionada["preco"] = 60.00
    else:
        bot.send_message(chatId, f"Escolha um tamanho!")
        return

    bot.send_message(chatId, f"Quantas Pizzas deseja? Digite o n√∫mero de pizzas que deseja.")

def pizzaDefinirQuantidade(tamanho, chatId):
    global pizzaSelecionada
    
    try:
        pizzaSelecionada["quantidade"] = int(tamanho)
    except ValueError:
        bot.send_message(chatId, f"Digite o n√∫mero de pizzas que deseja!")
        return
    
    try:
        precoCalculado = pizzaSelecionada["quantidade"] * pizzaSelecionada["preco"]
        preco = format_currency(precoCalculado, 'BRL', locale='pt_BR')
        markup = types.InlineKeyboardMarkup()

        # Adicione bot√µes inline com comandos
        botao1 = types.InlineKeyboardButton("Inicioüè†", callback_data='inicio')

        markup.add(botao1)

        bot.send_message(chatId, f"""James est√° chegando a todo vapor com o seu pedido!üéÅüèç
Pizza saborüçï: {pizzaSelecionada["sabor"].capitalize()}
QuantidadeüîÑ: {pizzaSelecionada["quantidade"]}
Pre√ßoüí∞: {preco}""", reply_markup=markup)
        pizzaSelecionada = {}
    except ValueError as erro:
        print(erro)

# Manipulador de consulta de bot√£o inline
@bot.callback_query_handler(func=lambda call: True)
def callback_query(call):
    chatId = call.message.chat.id 
    mensagem = call.message
    global pizzaSelecionada

    if call.data == 'cardapio':
        texto = """
Qual sabor desejaüçïüçï?
    /nutella Nutellaüç´
    /calabresa Calabresaüçï
    /portuguesa Portuguesaüáµüáπ
    /frango Frango com catupiryüßÄ
    /recomendacao Pedir recomenda√ß√£oüÜò"""

        markup = types.InlineKeyboardMarkup()

        # Adicione bot√µes inline com comandos
        botao1 = types.InlineKeyboardButton("Pizza de Nutellaüç´", callback_data='nutella')
        botao2 = types.InlineKeyboardButton("Pizza de Calabresaüçï", callback_data='calabresa')
        botao3 = types.InlineKeyboardButton("Pizza Portuguesaüáµüáπ", callback_data='portuguesa')
        botao4 = types.InlineKeyboardButton("Pizza de Frango e CatupiryüßÄ", callback_data='frango')
        botao5 = types.InlineKeyboardButton("Pedir recomenda√ß√£oüÜò", callback_data='recomendacao')
        botao6 = types.InlineKeyboardButton("Inicioüè†", callback_data='inicio')

        markup.add(botao1, botao2)
        markup.add(botao3, botao4)
        markup.add(botao5, botao6)
        bot.send_message(chatId, texto, reply_markup=markup)
    elif call.data == 'nutella':
        texto = """
        Escolha o tamanho:
    1 - Pequena, R$20,00
    2 - M√©dia, R$35,00
    3 - Grande, R$45,00
Digite o n√∫mero do tamanho que deseja, ou clique em um dos bot√µes abaixo:"""

        markup = types.InlineKeyboardMarkup()

        # Adicione bot√µes inline com comandos
        botao1 = types.InlineKeyboardButton("Pequena", callback_data='pequena')
        botao2 = types.InlineKeyboardButton("M√©dia", callback_data='media')
        botao3 = types.InlineKeyboardButton("Grande", callback_data='grande')
        botao4 = types.InlineKeyboardButton("Inicioüè†", callback_data='inicio')

        markup.add(botao1, botao2, botao3)
        markup.add(botao4)

        pizzaSelecionada["sabor"] = "nutella"
        bot.send_message(chatId, texto, reply_markup=markup)
    elif call.data == 'calabresa':
        texto = """
        Escolha o tamanho:
    1 - Pequena, R$30,00
    2 - M√©dia, R$45.00
    3 - Grande, R$50.00
Digite o n√∫mero do tamanho que deseja, ou clique em um dos bot√µes abaixo:"""

        markup = types.InlineKeyboardMarkup()

        # Adicione bot√µes inline com comandos
        botao1 = types.InlineKeyboardButton("Pequena", callback_data='pequena')
        botao2 = types.InlineKeyboardButton("M√©dia", callback_data='media')
        botao3 = types.InlineKeyboardButton("Grande", callback_data='grande')
        botao4 = types.InlineKeyboardButton("Inicioüè†", callback_data='inicio')

        markup.add(botao1, botao2, botao3)
        markup.add(botao4)

        pizzaSelecionada["sabor"] = "calabresa"
        bot.send_message(chatId, texto, reply_markup=markup)
    elif call.data == 'portuguesa':
        texto = """
        Escolha o tamanho:
    1 - Pequena, R$20,00
    2 - M√©dia, R$35.00
    3 - Grande, R$45.00
Digite o n√∫mero do tamanho que deseja, ou clique em um dos bot√µes abaixo:"""

        markup = types.InlineKeyboardMarkup()

        # Adicione bot√µes inline com comandos
        botao1 = types.InlineKeyboardButton("Pequena", callback_data='pequena')
        botao2 = types.InlineKeyboardButton("M√©dia", callback_data='media')
        botao3 = types.InlineKeyboardButton("Grande", callback_data='grande')
        botao4 = types.InlineKeyboardButton("Inicioüè†", callback_data='inicio')

        markup.add(botao1, botao2, botao3)
        markup.add(botao4)

        pizzaSelecionada["sabor"] = "portuguesa"
        bot.send_message(chatId, texto, reply_markup=markup)
    elif call.data == 'frango':
        texto = """
        Escolha o tamanho:
    1 - Pequena, R$30,00
    2 - M√©dia, R$45.00
    3 - Grande, R$60.00
Digite o n√∫mero do tamanho que deseja, ou clique em um dos bot√µes abaixo:"""

        markup = types.InlineKeyboardMarkup()

        # Adicione bot√µes inline com comandos
        botao1 = types.InlineKeyboardButton("Pequena", callback_data='pequena')
        botao2 = types.InlineKeyboardButton("M√©dia", callback_data='media')
        botao3 = types.InlineKeyboardButton("Grande", callback_data='grande')
        botao4 = types.InlineKeyboardButton("Inicioüè†", callback_data='inicio')

        markup.add(botao1, botao2, botao3)
        markup.add(botao4)

        pizzaSelecionada["sabor"] = "frango"
        bot.send_message(chatId, texto, reply_markup=markup)
    elif call.data == 'recomendacao':
        recomendacao(mensagem)
    elif pizzaSelecionada and pizzaSelecionada["sabor"] and call.data == 'pequena':
        pizzaDefinirTamanho("1", chatId)
    elif pizzaSelecionada and pizzaSelecionada["sabor"] and call.data == 'media':
        pizzaDefinirTamanho("2", chatId)
    elif pizzaSelecionada and pizzaSelecionada["sabor"] and call.data == 'grande':
        pizzaDefinirTamanho("3", chatId)
    elif not "sabor" in pizzaSelecionada and call.data == 'pequena':
        markup = types.InlineKeyboardMarkup()

        # Adicione bot√µes inline com comandos
        botao1 = types.InlineKeyboardButton("Card√°pioüìã", callback_data='cardapio')
        botao2 = types.InlineKeyboardButton("Inicioüè†", callback_data='inicio')

        markup.add(botao1, botao2)

        bot.send_message(chatId, "Escolha um sabor de Pizza", reply_markup=markup)
    elif not "sabor" in pizzaSelecionada and call.data == 'media':
        markup = types.InlineKeyboardMarkup()

        # Adicione bot√µes inline com comandos
        botao1 = types.InlineKeyboardButton("Card√°pioüìã", callback_data='cardapio')
        botao2 = types.InlineKeyboardButton("Inicioüè†", callback_data='inicio')

        markup.add(botao1, botao2)

        bot.send_message(chatId, "Escolha um sabor de Pizza", reply_markup=markup)
    elif not "sabor" in pizzaSelecionada and call.data == 'grande':
        markup = types.InlineKeyboardMarkup()

        # Adicione bot√µes inline com comandos
        botao1 = types.InlineKeyboardButton("Card√°pioüìã", callback_data='cardapio')
        botao2 = types.InlineKeyboardButton("Inicioüè†", callback_data='inicio')

        markup.add(botao1, botao2)

        bot.send_message(chatId, "Escolha um sabor de Pizza", reply_markup=markup)
    elif call.data == 'reclamar':
        reclamar(mensagem)
    elif call.data == 'sobre':
        sobre(mensagem)
    elif call.data == 'inicio':
        markup = types.InlineKeyboardMarkup()

        # Adicione bot√µes inline com comandos
        botao1 = types.InlineKeyboardButton("Card√°pioüìã", callback_data='cardapio')
        botao2 = types.InlineKeyboardButton("Sobre mimüôéüèΩ‚Äç‚ôÇÔ∏è", callback_data='sobre')
        botao3 = types.InlineKeyboardButton("Reclamar de um pedidoüó£", callback_data='reclamar')


        markup.add(botao1, botao2)
        markup.add(botao3)

        bot.send_message(chatId, """
        Voc√™ acabou de invocar os servi√ßos de James. O que quer da realeza? fa√ßa a sua escolha:
        /menu Card√°pioüìã
        /sobre Sobre mimüôéüèΩ‚Äç‚ôÇÔ∏è
        /reclamar Reclamar de um pedidoüó£
Ou clique em um dos bot√µes abaixo‚¨áÔ∏è:""", reply_markup=markup)

def verificar(mensagem):
    if pizzaSelecionada and pizzaSelecionada["sabor"] and "tamanho" not in pizzaSelecionada:
        pizzaDefinirTamanho(mensagem.text, mensagem.chat.id)
        return
    elif pizzaSelecionada and pizzaSelecionada["sabor"] and pizzaSelecionada["tamanho"]:
        pizzaDefinirQuantidade(mensagem.text, mensagem.chat.id)
        return
    return True

@bot.message_handler(func=verificar)
def responder(mensagem):
    markup = types.InlineKeyboardMarkup()

    # Adicione bot√µes inline com comandos
    botao1 = types.InlineKeyboardButton("Card√°pioüìã", callback_data='cardapio')
    botao2 = types.InlineKeyboardButton("Sobre mimüôéüèΩ‚Äç‚ôÇÔ∏è", callback_data='sobre')
    botao3 = types.InlineKeyboardButton("Reclamar de um pedidoüó£", callback_data='reclamar')

    markup.add(botao1, botao2)
    markup.add(botao3)

    bot.reply_to(mensagem, """
    Voc√™ acabou de invocar os servi√ßos de James. O que quer da realeza? fa√ßa a sua escolha:
/cardapio Card√°pioüìã
/sobre Sobre mimüôéüèΩ‚Äç‚ôÇÔ∏è
/reclamar Reclamar de um pedidoüó£
Ou clique em um dos bot√µes abaixo‚¨áÔ∏è:""", reply_markup=markup)
